<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELI5 - Explain Like I'm 5 (Single File)</title>
    <style>
        :root {
            --primary: #03a9f4;
            --primary-dark: #0288d1;
            --secondary: #ff9800;
            --dark: #1f2235;
            --darker: #131425;
            --light: #f8f9fa;
            --gray: #a0a0a0;
            --success: #4dd599;
            --danger: #ff5252;
            --warning: #ffc107;
            --gradient-bg: linear-gradient(135deg, var(--dark), var(--darker));
        }
        
        * {
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient-bg);
            color: var(--light);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 
                        0 1px 3px rgba(255, 255, 255, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.05);
            width: 100%;
            max-width: 800px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 20px;
            position: relative;
        }

        header h1 {
            color: var(--primary);
            margin: 0;
            font-size: 3rem;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(108, 99, 255, 0.5);
            animation: floating 4s ease-in-out infinite;
        }

        header p {
            color: var(--gray);
            letter-spacing: 1px;
        }

        .input-area {
            margin-bottom: 25px;
        }

        .input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .input-area input {
            display: block;
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 16px;
            color: var(--light);
            outline: none;
            transition: all 0.3s;
        }

        .input-area input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.25);
        }

        .input-area input::placeholder {
            color: var(--gray);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .button-group button {
            flex-grow: 1;
            padding: 14px 15px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .button-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 15px rgba(108, 99, 255, 0.4);
        }

        .button-group button:active {
            transform: translateY(1px);
        }

        .button-group button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
            z-index: -1;
        }

        .button-group button:hover::before {
            left: 100%;
        }

        .output-area h2 {
            color: var(--primary);
            margin-top: 0;
            font-weight: 600;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
        }

        .output-area h2::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 20px;
            background: var(--primary);
            margin-right: 10px;
            border-radius: 3px;
        }

        .content-box {
            background-color: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            min-height: 200px;
            white-space: pre-wrap;
            line-height: 1.7;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 16px;
        }

        .content-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            z-index: -1;
            background: linear-gradient(45deg, transparent, rgba(108, 99, 255, 0.03), transparent);
            transform: skew(-20deg);
        }

        #loadingIndicator {
            text-align: center;
            padding: 30px;
            color: var(--primary);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            position: relative;
        }

        .loading-spinner:before, 
        .loading-spinner:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: var(--primary);
        }

        .loading-spinner:before {
            animation: spinnerAnimation 1.5s linear infinite;
            z-index: 2;
        }

        .loading-spinner:after {
            border: 3px solid rgba(255,255,255,0.1);
            z-index: 1;
        }

        @keyframes spinnerAnimation {
            0%   { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-weight: 500;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .loading-dots {
            display: none;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9em;
            color: var(--gray);
        }

        /* Glowing orbs in background */
        .orbs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.15;
            animation: orbit 20s infinite linear;
        }

        .orb:nth-child(1) {
            top: 20%;
            left: 10%;
            width: 300px;
            height: 300px;
            background-color: var(--primary);
        }

        .orb:nth-child(2) {
            bottom: 10%;
            right: 15%;
            width: 250px;
            height: 250px;
            background-color: var(--secondary);
            animation-duration: 25s;
            animation-direction: reverse;
        }

        @keyframes orbit {
            from { transform: rotate(0deg) translateX(100px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(100px) rotate(-360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            header h1 {
                font-size: 2.5rem;
            }
        }

        /* Flashcard styles */
        .flashcard-container {
            max-width: 500px;
            margin: 20px auto;
        }
        
        .flashcard {
            position: relative;
            height: 250px;
            width: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        
        .flashcard-face {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--light);
        }
        
        .flashcard-front {
            font-weight: bold;
            font-size: 24px;
            text-align: center;
        }
        
        .flashcard-back {
            transform: rotateY(180deg);
            font-size: 18px;
            text-align: center;
        }
        
        .card-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .card-nav button {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .card-nav button:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .card-nav button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .card-indicator {
            text-align: center;
            margin: 10px 0;
            color: var(--gray);
            font-size: 14px;
        }
        
        /* Test styles */
        .test-container {
            margin: 20px 0;
        }
        
        .question {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .question h3 {
            margin-top: 0;
            color: var(--light);
        }
        
        .options {
            list-style: none;
            padding: 0;
        }
        
        .option {
            padding: 10px 15px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .option.selected {
            background: rgba(108, 99, 255, 0.2);
            border-color: var(--primary);
        }
        
        .option.correct {
            background: rgba(77, 213, 153, 0.2);
            border-color: var(--success);
        }
        
        .option.incorrect {
            background: rgba(255, 82, 82, 0.2);
            border-color: var(--danger);
        }
        
        .submit-button {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.3);
        }
        
        .result {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .score {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .card-notice {
            text-align: center;
            color: var(--light);
            font-style: italic;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        /* Customization panels */
        .customization-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .customization-panel h3 {
            margin-top: 0;
            color: var(--primary);
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--light);
        }
        
        .range-slider {
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        .slider-value {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-top: 10px;
        }
        
        .test-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .test-type-option {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .test-type-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .test-type-option.selected {
            background: rgba(108, 99, 255, 0.2);
            border-color: var(--primary);
        }
        
        .generate-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.3);
        }

        .question-type-indicator {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            margin-bottom: 8px;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .keyboard-shortcut {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.8rem;
            margin-left: 8px;
            color: var(--gray);
        }
        
        .floating-action-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
        }
        
        .floating-action-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        
        /* Theme switcher */
        .theme-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
        }
        
        .theme-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .theme-option:hover {
            transform: scale(1.2);
        }
        
        .theme-option.active {
            border-color: white;
        }
        
        /* Themes */
        .theme-purple {
            --primary: #6c63ff;
            --primary-dark: #5a52d9;
            --secondary: #ff6584;
        }
        
        .theme-blue {
            --primary: #03a9f4;
            --primary-dark: #0288d1;
            --secondary: #ff9800;
        }
        
        .theme-green {
            --primary: #4dd599;
            --primary-dark: #3cb179;
            --secondary: #ff5252;
        }
        
        .theme-dark {
            --dark: #1f2235;
            --darker: #131425;
        }
        
        .theme-darker {
            --dark: #121212;
            --darker: #000000;
        }
        
        /* Keyboard shortcuts help */
        .keyboard-help {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 15px;
            color: white;
            max-width: 300px;
            z-index: 100;
            transform: translateY(150%);
            transition: transform 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .keyboard-help.visible {
            transform: translateY(0);
        }
        
        .keyboard-help h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .keyboard-help ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .keyboard-help li {
            margin-bottom: 5px;
        }
        
        .keyboard-help .shortcut {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            transition: transform 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .notification.visible {
            transform: translateX(-50%) translateY(0);
        }

        /* Save/List functionality */
        .save-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--light);
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .save-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .save-btn:before {
            content: 'üíæ';
            margin-right: 8px;
        }

        .saved-list-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .saved-list-container h3 {
            margin-top: 0;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .saved-items {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .saved-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .saved-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .saved-item-title {
            flex-grow: 1;
            font-size: 14px;
        }

        .saved-item-type {
            background: rgba(3, 169, 244, 0.2);
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            margin-right: 10px;
        }

        .saved-item-actions {
            display: flex;
            gap: 10px;
        }

        .saved-item-actions button {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 18px;
            padding: 2px;
            transition: all 0.3s;
        }

        .saved-item-actions button:hover {
            color: var(--light);
        }

        .saved-item-actions button.load-btn:hover {
            color: var(--primary);
        }

        .saved-item-actions button.delete-btn:hover {
            color: var(--danger);
        }

        .saved-item-actions button.load-btn:before {
            content: 'üìÇ';
        }

        .saved-item-actions button.delete-btn:before {
            content: 'üóëÔ∏è';
        }

        .save-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .save-modal.visible {
            opacity: 1;
            visibility: visible;
        }

        .save-modal-content {
            background: var(--gradient-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateY(20px);
            transition: all 0.3s;
        }

        .save-modal.visible .save-modal-content {
            transform: translateY(0);
        }

        .save-modal-content h3 {
            margin-top: 0;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .save-modal-content input {
            width: 100%;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--light);
            margin-bottom: 20px;
        }

        .save-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .save-modal-actions button {
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
        }

        .save-modal-actions button.cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: none;
        }

        .save-modal-actions button.confirm-btn {
            background: var(--primary);
            color: white;
            border: none;
        }

        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
            gap: 10px;
        }

        .tab-button {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-button.active {
            background: rgba(3, 169, 244, 0.2);
            border-color: var(--primary);
        }

        .tab-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Add voice reader button styles */
        .voice-reader-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--light);
            margin-left: 10px;
            transition: all 0.3s;
        }
        
        .voice-reader-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .voice-reader-btn.speaking {
            background: rgba(3, 169, 244, 0.3);
            border-color: var(--primary);
        }
    </style>
</head>
<body class="theme-blue theme-dark">
    <div class="orbs">
        <div class="orb"></div>
        <div class="orb"></div>
    </div>

    <div class="container">
        <header>
            <h1>ELI5</h1>
            <p>Explain any topic, for any age!</p>
        </header>

        <main>
            <div class="input-area">
                <div class="input-group">
                    <input type="text" id="topicInput" placeholder="Enter topic (e.g., 'Black Holes')">
                </div>
                <div class="input-group">
                    <input type="number" id="ageInput" placeholder="Enter target age (e.g., 5, 10, 25)" min="1">
                </div>
                <div class="button-group">
                    <button id="explainBtn">Explain <span class="keyboard-shortcut">E</span></button>
                    <button id="customizeFlashcardsBtn">Create Flashcards <span class="keyboard-shortcut">F</span></button>
                    <button id="customizeTestBtn">Create Test <span class="keyboard-shortcut">T</span></button>
                    <button id="savedContentBtn">Saved Content <span class="keyboard-shortcut">S</span></button>
                </div>
            </div>

            <div id="loadingIndicator" style="display:none;">
                <div class="loading-spinner"></div>
                <div class="loading-text">Generating your content</div>
                <div class="loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            
            <div class="output-area">
                <h2>Explanation / Content: <button id="voiceReaderBtn" class="voice-reader-btn" title="Read text aloud"><i>üîä</i></button></h2>
                <div id="explanationOutput" class="content-box">
                    <div style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">Your explanation will appear here.</div>
                </div>
            </div>
        </main>

        <footer>
            <p>ELI5 App - Powered by AI <span style="cursor:pointer" onclick="toggleKeyboardHelp()">(?)</span></p>
        </footer>
    </div>
    
    <div class="keyboard-help" id="keyboardHelp">
        <h4>Keyboard Shortcuts</h4>
        <ul>
            <li><span class="shortcut">E</span> Explain topic</li>
            <li><span class="shortcut">F</span> Create flashcards</li>
            <li><span class="shortcut">T</span> Create test</li>
            <li><span class="shortcut">?</span> Toggle this help</li>
            <li><span class="shortcut">Esc</span> Close help</li>
        </ul>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <!-- Save modal -->
    <div class="save-modal" id="saveModal">
        <div class="save-modal-content">
            <h3>Save Content</h3>
            <input type="text" id="saveNameInput" placeholder="Enter a name for this content">
            <div class="save-modal-actions">
                <button class="cancel-btn" id="cancelSaveBtn">Cancel</button>
                <button class="confirm-btn" id="confirmSaveBtn">Save</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const topicInput = document.getElementById('topicInput');
            const ageInput = document.getElementById('ageInput');
            const explainBtn = document.getElementById('explainBtn');
            const customizeFlashcardsBtn = document.getElementById('customizeFlashcardsBtn');
            const customizeTestBtn = document.getElementById('customizeTestBtn');
            const savedContentBtn = document.getElementById('savedContentBtn');
            const explanationOutput = document.getElementById('explanationOutput');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const keyboardHelp = document.getElementById('keyboardHelp');
            const notification = document.getElementById('notification');
            const voiceReaderBtn = document.getElementById('voiceReaderBtn');
            
            // Speech synthesis variables
            let speechSynthesis = window.speechSynthesis;
            let isSpeaking = false;
            let currentUtterance = null;
            
            // Voice reader functionality
            function readText(text) {
                // Stop any ongoing speech
                if (isSpeaking) {
                    stopSpeaking();
                    return;
                }
                
                // Create utterance
                currentUtterance = new SpeechSynthesisUtterance(text);
                
                // Set voice (optional - uses default)
                // const voices = speechSynthesis.getVoices();
                // if (voices.length > 0) {
                //     currentUtterance.voice = voices[0];
                // }
                
                // Set properties
                currentUtterance.rate = 1.0;
                currentUtterance.pitch = 1.0;
                currentUtterance.volume = 1.0;
                
                // Add events
                currentUtterance.onstart = function() {
                    isSpeaking = true;
                    voiceReaderBtn.classList.add('speaking');
                    voiceReaderBtn.innerHTML = '‚èπÔ∏è';
                    voiceReaderBtn.title = 'Stop reading';
                };
                
                currentUtterance.onend = function() {
                    isSpeaking = false;
                    voiceReaderBtn.classList.remove('speaking');
                    voiceReaderBtn.innerHTML = 'üîä';
                    voiceReaderBtn.title = 'Read text aloud';
                };
                
                // Speak
                speechSynthesis.speak(currentUtterance);
            }
            
            function stopSpeaking() {
                if (speechSynthesis) {
                    speechSynthesis.cancel();
                    isSpeaking = false;
                    voiceReaderBtn.classList.remove('speaking');
                    voiceReaderBtn.innerHTML = 'üîä';
                    voiceReaderBtn.title = 'Read text aloud';
                }
            }
            
            // Add voice reader button event listener
            voiceReaderBtn.addEventListener('click', function() {
                let textToRead;
                
                if (currentContent.type === 'flashcards' && flashcards.length > 0) {
                    // For flashcards, read the current card
                    textToRead = `Question: ${flashcards[currentCardIndex].question}. Answer: ${flashcards[currentCardIndex].answer}`;
                } else {
                    // For regular explanation, read the content
                    textToRead = explanationOutput.textContent.trim();
                    
                    // If it's the default text, don't read
                    if (textToRead === 'Your explanation will appear here.') {
                        showNotification('No content to read yet');
                        return;
                    }
                }
                
                readText(textToRead);
            });
            
            // Helper function to add voice reader to flashcards
            function addFlashcardVoiceReader(cardContainer) {
                const readerBtn = document.createElement('button');
                readerBtn.className = 'voice-reader-btn';
                readerBtn.innerHTML = 'üîä';
                readerBtn.title = 'Read card aloud';
                readerBtn.style.position = 'absolute';
                readerBtn.style.top = '10px';
                readerBtn.style.right = '10px';
                readerBtn.style.zIndex = '10';
                
                readerBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent card flip
                    
                    const card = this.closest('.flashcard');
                    const isFlipped = card.classList.contains('flipped');
                    const textToRead = isFlipped ? 
                        flashcards[currentCardIndex].answer : 
                        flashcards[currentCardIndex].question;
                    
                    readText(textToRead);
                });
                
                cardContainer.appendChild(readerBtn);
            }
            
            // Stop speaking when navigating away
            window.addEventListener('beforeunload', stopSpeaking);

            // Add some interaction effects
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('mouseenter', () => {
                    button.style.transform = 'translateY(-2px)';
                });
                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                });
            });

            // Animate the content box when new content is loaded
            function animateContent() {
                explanationOutput.style.opacity = '0';
                explanationOutput.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    explanationOutput.style.opacity = '1';
                    explanationOutput.style.transform = 'translateY(0)';
                }, 100);
            }

            // Flashcards and tests storage
            let flashcards = [];
            let currentCardIndex = 0;
            let testQuestions = [];
            let userAnswers = {};
            
            // Current content tracking
            let currentContent = {
                type: null, // 'explanation', 'flashcards', 'test'
                topic: '',
                age: '',
                content: null,
                timestamp: null
            };
            
            // Customization settings
            let flashcardSettings = {
                count: 10
            };
            
            let testSettings = {
                type: 'multiple-choice',
                count: 5
            };
            
            // Load settings from local storage
            loadSettings();
            
            // Global keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Only trigger if not in an input field
                if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                    if (e.key.toLowerCase() === 'e') {
                        explainBtn.click();
                    } else if (e.key.toLowerCase() === 'f') {
                        customizeFlashcardsBtn.click();
                    } else if (e.key.toLowerCase() === 't') {
                        customizeTestBtn.click();
                    } else if (e.key.toLowerCase() === 's') {
                        savedContentBtn.click();
                    } else if (e.key === '?') {
                        toggleKeyboardHelp();
                    } else if (e.key === 'Escape') {
                        keyboardHelp.classList.remove('visible');
                        document.getElementById('saveModal').classList.remove('visible');
                    }
                }
            });
            
            // Show/hide keyboard help
            window.toggleKeyboardHelp = function() {
                keyboardHelp.classList.toggle('visible');
            };
            
            // Show notification
            function showNotification(message, duration = 3000) {
                notification.textContent = message;
                notification.classList.add('visible');
                
                setTimeout(() => {
                    notification.classList.remove('visible');
                }, duration);
            }
            
            // Save settings to local storage
            function saveSettings() {
                const settings = {
                    flashcardSettings,
                    testSettings,
                    lastTopic: topicInput.value,
                    lastAge: ageInput.value
                };
                
                localStorage.setItem('eli5-settings', JSON.stringify(settings));
            }
            
            // Load settings from local storage
            function loadSettings() {
                const savedSettings = localStorage.getItem('eli5-settings');
                
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    
                    // Restore settings
                    if (settings.flashcardSettings) flashcardSettings = settings.flashcardSettings;
                    if (settings.testSettings) testSettings = settings.testSettings;
                    
                    // Restore last inputs
                    if (settings.lastTopic) topicInput.value = settings.lastTopic;
                    if (settings.lastAge) ageInput.value = settings.lastAge;
                }
            }
            
            // Auto-save inputs
            topicInput.addEventListener('change', saveSettings);
            ageInput.addEventListener('change', saveSettings);

            // !!! IMPORTANT SECURITY RISK !!!
            // Your API key is exposed in client-side code here.
            // This is NOT recommended for production applications.
            // Replace with your actual OpenRouter API Key
            const OPENROUTER_API_KEY = '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';
            const AI_MODEL = 'openai/gpt-4o'; // Updated to GPT-4.1 (GPT-4o)

            function showFlashcardCustomization() {
                explanationOutput.innerHTML = '';
                
                const panel = document.createElement('div');
                panel.className = 'customization-panel';
                
                panel.innerHTML = `
                    <h3>Customize Flashcards</h3>
                    
                    <div class="form-group">
                        <label>Number of Flashcards (5-35):</label>
                        <input type="range" class="range-slider" id="flashcardCountSlider" 
                            min="5" max="35" step="5" value="${flashcardSettings.count}">
                        <div class="slider-value" id="flashcardCountValue">${flashcardSettings.count}</div>
                    </div>
                    
                    <button class="generate-btn" id="generateFlashcardsBtn">Generate Flashcards <span class="keyboard-shortcut">Enter</span></button>
                `;
                
                explanationOutput.appendChild(panel);
                
                // Add event listeners
                const slider = document.getElementById('flashcardCountSlider');
                const sliderValue = document.getElementById('flashcardCountValue');
                
                slider.addEventListener('input', function() {
                    sliderValue.textContent = this.value;
                    flashcardSettings.count = parseInt(this.value);
                });
                
                const generateBtn = document.getElementById('generateFlashcardsBtn');
                generateBtn.addEventListener('click', function() {
                    fetchAIResponse('flashcards');
                });
                
                // Add keyboard shortcut
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && document.activeElement !== topicInput && document.activeElement !== ageInput) {
                        generateBtn.click();
                    }
                });
            }
            
            function showTestCustomization() {
                explanationOutput.innerHTML = '';
                
                const panel = document.createElement('div');
                panel.className = 'customization-panel';
                
                panel.innerHTML = `
                    <h3>Customize Test</h3>
                    
                    <div class="form-group">
                        <label>Test Type:</label>
                        <div class="test-options">
                            <div class="test-type-option ${testSettings.type === 'multiple-choice' ? 'selected' : ''}" data-type="multiple-choice">Multiple Choice</div>
                            <div class="test-type-option ${testSettings.type === 'true-false' ? 'selected' : ''}" data-type="true-false">True/False</div>
                            <div class="test-type-option ${testSettings.type === 'fill-blank' ? 'selected' : ''}" data-type="fill-blank">Fill in the Blank</div>
                            <div class="test-type-option ${testSettings.type === 'matching' ? 'selected' : ''}" data-type="matching">Matching</div>
                            <div class="test-type-option ${testSettings.type === 'mixed' ? 'selected' : ''}" data-type="mixed">Mixed</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Number of Questions (5-20):</label>
                        <input type="range" class="range-slider" id="testCountSlider" 
                            min="5" max="20" step="5" value="${testSettings.count}">
                        <div class="slider-value" id="testCountValue">${testSettings.count}</div>
                    </div>
                    
                    <button class="generate-btn" id="generateTestBtn">Generate Test <span class="keyboard-shortcut">Enter</span></button>
                `;
                
                explanationOutput.appendChild(panel);
                
                // Add event listeners
                const slider = document.getElementById('testCountSlider');
                const sliderValue = document.getElementById('testCountValue');
                
                slider.addEventListener('input', function() {
                    sliderValue.textContent = this.value;
                    testSettings.count = parseInt(this.value);
                });
                
                const typeOptions = document.querySelectorAll('.test-type-option');
                typeOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        typeOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        testSettings.type = this.getAttribute('data-type');
                    });
                });
                
                const generateBtn = document.getElementById('generateTestBtn');
                generateBtn.addEventListener('click', function() {
                    fetchAIResponse('test');
                });
                
                // Add keyboard shortcut
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && document.activeElement !== topicInput && document.activeElement !== ageInput) {
                        generateBtn.click();
                    }
                });
            }

            async function fetchAIResponse(feature) {
                const topic = topicInput.value.trim();
                const age = ageInput.value.trim();

                if (!topic || !age) {
                    explanationOutput.textContent = 'Please enter both a topic and an age.';
                    return;
                }

                loadingIndicator.style.display = 'block';
                explanationOutput.textContent = '';

                // Update current content info
                currentContent.topic = topic;
                currentContent.age = age;
                currentContent.type = feature;
                currentContent.timestamp = new Date().toISOString();

                let systemPrompt = `You are ELI5, an AI assistant that explains complex topics in a simple and understandable way.`;
                let userPrompt = `Explain the topic "${topic}" to me as if I were ${age} years old. Keep it simple, engaging, and easy to understand.`;

                if (feature === 'flashcards') {
                    userPrompt = `Based on an explanation of "${topic}" suitable for a ${age}-year-old, generate ${flashcardSettings.count} flashcards. 
                    Each flashcard should have a question or term on one side and a simple answer or definition on the other.
                    Format the response as a JSON array with question and answer properties, like this:
                    [
                      {"question": "Question text here", "answer": "Answer text here"},
                      {"question": "Question text here", "answer": "Answer text here"}
                    ]
                    Only return a valid JSON array with no other text or explanation.`;
                } else if (feature === 'test') {
                    if (testSettings.type === 'multiple-choice') {
                        userPrompt = `Based on an explanation of "${topic}" suitable for a ${age}-year-old, create a quiz with ${testSettings.count} multiple-choice questions.
                        Each question should have one correct answer and two plausible distractors.
                        Format the response as a JSON array, like this:
                        [
                          {
                            "question": "Question text here",
                            "options": ["Option A", "Option B", "Option C"],
                            "correctAnswer": 0
                          }
                        ]
                        Where "correctAnswer" is the index (0, 1, or 2) of the correct option.
                        Only return a valid JSON array with no other text or explanation.`;
                    } 
                    else if (testSettings.type === 'true-false') {
                        userPrompt = `Based on an explanation of "${topic}" suitable for a ${age}-year-old, create a quiz with ${testSettings.count} true/false questions.
                        Format the response as a JSON array, like this:
                        [
                          {
                            "question": "Statement that is either true or false",
                            "correctAnswer": true
                          }
                        ]
                        Where "correctAnswer" is a boolean (true or false) indicating whether the statement is true or false.
                        Only return a valid JSON array with no other text or explanation.`;
                    }
                    else if (testSettings.type === 'fill-blank') {
                        userPrompt = `Based on an explanation of "${topic}" suitable for a ${age}-year-old, create a quiz with ${testSettings.count} fill-in-the-blank questions.
                        Format the response as a JSON array, like this:
                        [
                          {
                            "question": "The sun is a _____ star.",
                            "answer": "yellow"
                          }
                        ]
                        Where "question" includes an underscored blank (using 5 underscores "_____") where the answer should go.
                        Only return a valid JSON array with no other text or explanation.`;
                    }
                    else if (testSettings.type === 'matching') {
                        userPrompt = `Based on an explanation of "${topic}" suitable for a ${age}-year-old, create a matching quiz with ${testSettings.count} pairs.
                        Format the response as a JSON array, like this:
                        [
                          {
                            "term": "Term or concept",
                            "definition": "Definition or description"
                          }
                        ]
                        Make all terms and definitions clearly related to the topic.
                        Only return a valid JSON array with no other text or explanation.`;
                    }
                    else if (testSettings.type === 'mixed') {
                        userPrompt = `Based on an explanation of "${topic}" suitable for a ${age}-year-old, create a mixed quiz with ${testSettings.count} total questions.
                        The quiz should include a variety of question types:
                        1. Multiple choice questions (with format: {"type": "multiple-choice", "question": "Question text?", "options": ["Option A", "Option B", "Option C"], "correctAnswer": 0})
                        2. True/false questions (with format: {"type": "true-false", "question": "Statement that is true or false", "correctAnswer": true})
                        3. Fill in the blank questions (with format: {"type": "fill-blank", "question": "The sun is a _____ star.", "answer": "yellow"})
                        
                        Format the response as a JSON array containing these different question types mixed together.
                        Make sure each question has a "type" field specifying what type of question it is.
                        Only return a valid JSON array with no other text or explanation.`;
                    }
                }

                try {
                    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: AI_MODEL,
                            messages: [
                                { role: 'system', content: systemPrompt },
                                { role: 'user', content: userPrompt },
                            ],
                        }),
                    });

                    loadingIndicator.style.display = 'none';

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ detail: `HTTP error! status: ${response.status}` }));
                        // OpenRouter often puts detailed errors in response.error.message or response.error.detail
                        let errorMessage = `HTTP error! status: ${response.status}`;
                        if (errorData.error && errorData.error.message) {
                            errorMessage = errorData.error.message;
                        } else if (errorData.detail) {
                            errorMessage = errorData.detail;
                        }
                        throw new Error(errorMessage);
                    }

                    const data = await response.json();

                    if (data.choices && data.choices.length > 0 && data.choices[0].message) {
                        const content = data.choices[0].message.content;
                        
                        if (feature === 'explain') {
                            // Standard explanation
                            animateContent();
                            explanationOutput.textContent = content;
                            
                            // Store content
                            currentContent.content = content;
                            
                            // Add save button
                            addSaveButton();
                        } 
                        else if (feature === 'flashcards') {
                            try {
                                // Find JSON content - in case AI wraps it in markdown or explanation
                                const jsonMatch = content.match(/\[\s*\{.*\}\s*\]/s);
                                if (jsonMatch) {
                                    flashcards = JSON.parse(jsonMatch[0]);
                                } else {
                                    // Fallback: Try to parse the entire response
                                    flashcards = JSON.parse(content);
                                }
                                currentCardIndex = 0;
                                
                                // Store content
                                currentContent.content = flashcards;
                                
                                renderFlashcards();
                                
                                // Add save button
                                addSaveButton();
                            } catch (e) {
                                console.error("Failed to parse flashcards JSON:", e);
                                explanationOutput.textContent = "Couldn't parse flashcards format. Raw response:\n\n" + content;
                            }
                        } 
                        else if (feature === 'test') {
                            try {
                                // Find JSON content
                                const jsonMatch = content.match(/\[\s*\{.*\}\s*\]/s);
                                if (jsonMatch) {
                                    testQuestions = JSON.parse(jsonMatch[0]);
                                } else {
                                    // Fallback: Try to parse the entire response
                                    testQuestions = JSON.parse(content);
                                }
                                userAnswers = {};
                                
                                // Store content
                                currentContent.content = testQuestions;
                                
                                renderTest();
                                
                                // Add save button
                                addSaveButton();
                            } catch (e) {
                                console.error("Failed to parse test JSON:", e);
                                explanationOutput.textContent = "Couldn't parse test format. Raw response:\n\n" + content;
                            }
                        }
                    } else {
                        explanationOutput.textContent = 'No response content from AI model.';
                    }

                } catch (error) {
                    loadingIndicator.style.display = 'none';
                    explanationOutput.textContent = `Error: ${error.message}`;
                    console.error('Fetch error:', error);
                }
            }

            function renderFlashcards() {
                explanationOutput.innerHTML = '';
                
                // Create notice
                const notice = document.createElement('div');
                notice.className = 'card-notice';
                notice.innerHTML = 'Click on card to flip <span class="keyboard-shortcut">Space</span>';
                explanationOutput.appendChild(notice);
                
                // Progress bar
                const progressContainer = document.createElement('div');
                progressContainer.className = 'progress-bar-container';
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.style.width = `${((currentCardIndex + 1) / flashcards.length) * 100}%`;
                progressContainer.appendChild(progressBar);
                explanationOutput.appendChild(progressContainer);
                
                // Create flashcard container
                const container = document.createElement('div');
                container.className = 'flashcard-container';
                
                // Create flashcard
                const card = document.createElement('div');
                card.className = 'flashcard';
                card.onclick = function() {
                    this.classList.toggle('flipped');
                };
                
                // Create front and back
                const front = document.createElement('div');
                front.className = 'flashcard-face flashcard-front';
                front.textContent = flashcards[currentCardIndex].question;
                
                const back = document.createElement('div');
                back.className = 'flashcard-face flashcard-back';
                back.textContent = flashcards[currentCardIndex].answer;
                
                // Assemble card
                card.appendChild(front);
                card.appendChild(back);
                container.appendChild(card);
                
                // Add voice reader button to flashcard
                addFlashcardVoiceReader(card);
                
                // Create indicator
                const indicator = document.createElement('div');
                indicator.className = 'card-indicator';
                indicator.textContent = `Card ${currentCardIndex + 1} of ${flashcards.length}`;
                container.appendChild(indicator);
                
                // Create navigation
                const nav = document.createElement('div');
                nav.className = 'card-nav';
                
                const prevBtn = document.createElement('button');
                prevBtn.textContent = '‚Üê Previous';
                prevBtn.disabled = currentCardIndex === 0;
                prevBtn.onclick = function() {
                    if (currentCardIndex > 0) {
                        currentCardIndex--;
                        renderFlashcards();
                    }
                };
                
                const nextBtn = document.createElement('button');
                nextBtn.textContent = 'Next ‚Üí';
                nextBtn.disabled = currentCardIndex === flashcards.length - 1;
                nextBtn.onclick = function() {
                    if (currentCardIndex < flashcards.length - 1) {
                        currentCardIndex++;
                        renderFlashcards();
                    }
                };
                
                nav.appendChild(prevBtn);
                nav.appendChild(nextBtn);
                container.appendChild(nav);
                
                explanationOutput.appendChild(container);
                
                // Add keyboard navigation
                document.addEventListener('keydown', function(e) {
                    if (e.key === ' ' || e.key === 'Spacebar') {
                        card.click(); // Flip card with spacebar
                        e.preventDefault();
                    } else if (e.key === 'ArrowRight' && !nextBtn.disabled) {
                        nextBtn.click(); // Next card with right arrow
                    } else if (e.key === 'ArrowLeft' && !prevBtn.disabled) {
                        prevBtn.click(); // Previous card with left arrow
                    }
                });
                
                // Add floating action button for quick restart
                const fab = document.createElement('div');
                fab.className = 'floating-action-button';
                fab.innerHTML = '‚Üª';
                fab.title = 'Start over';
                fab.onclick = function() {
                    showFlashcardCustomization();
                };
                explanationOutput.appendChild(fab);
            }
            
            function renderTest() {
                explanationOutput.innerHTML = '';
                
                // Add progress tracking
                const progressContainer = document.createElement('div');
                progressContainer.className = 'progress-bar-container';
                progressContainer.style.marginBottom = '20px';
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.style.width = '0%';
                progressContainer.appendChild(progressBar);
                explanationOutput.appendChild(progressContainer);
                
                // Create test container
                const container = document.createElement('div');
                container.className = 'test-container';
                
                if (testSettings.type === 'multiple-choice') {
                    renderMultipleChoiceTest(container);
                } 
                else if (testSettings.type === 'true-false') {
                    renderTrueFalseTest(container);
                }
                else if (testSettings.type === 'fill-blank') {
                    renderFillBlankTest(container);
                }
                else if (testSettings.type === 'matching') {
                    renderMatchingTest(container);
                }
                else if (testSettings.type === 'mixed') {
                    renderMixedTest(container);
                }
                
                explanationOutput.appendChild(container);
                
                // Update progress bar
                updateTestProgress();
                
                // Add floating action button for quick restart
                const fab = document.createElement('div');
                fab.className = 'floating-action-button';
                fab.innerHTML = '‚Üª';
                fab.title = 'Start over';
                fab.onclick = function() {
                    showTestCustomization();
                };
                explanationOutput.appendChild(fab);
                
                // Add keyboard navigation
                setupTestKeyboardNavigation();
            }
            
            function updateTestProgress() {
                const answeredCount = Object.keys(userAnswers).length;
                const totalCount = testQuestions.length;
                const progressBar = document.querySelector('.progress-bar');
                
                if (progressBar) {
                    const percentage = (answeredCount / totalCount) * 100;
                    progressBar.style.width = `${percentage}%`;
                }
            }
            
            function setupTestKeyboardNavigation() {
                document.addEventListener('keydown', function(e) {
                    // For multiple choice questions, use number keys
                    if (['1', '2', '3'].includes(e.key)) {
                        const activeQuestion = document.activeElement.closest('.question');
                        if (activeQuestion) {
                            const questionIndex = Array.from(document.querySelectorAll('.question')).indexOf(activeQuestion);
                            if (questionIndex >= 0) {
                                const options = activeQuestion.querySelectorAll('.option');
                                const optionIndex = parseInt(e.key) - 1;
                                if (options[optionIndex]) {
                                    options[optionIndex].click();
                                }
                            }
                        }
                    }
                    
                    // For true/false questions, use T and F keys
                    if (e.key.toLowerCase() === 't' || e.key.toLowerCase() === 'f') {
                        const activeQuestion = document.activeElement.closest('.question');
                        if (activeQuestion) {
                            const options = activeQuestion.querySelectorAll('.option');
                            if (options.length === 2) { // True/False has 2 options
                                if (e.key.toLowerCase() === 't') options[0].click();
                                if (e.key.toLowerCase() === 'f') options[1].click();
                            }
                        }
                    }
                });
            }
            
            function renderMultipleChoiceTest(container) {
                // Create questions
                testQuestions.forEach((q, qIndex) => {
                    const question = document.createElement('div');
                    question.className = 'question';
                    
                    const title = document.createElement('h3');
                    title.textContent = `${qIndex + 1}. ${q.question}`;
                    question.appendChild(title);
                    
                    const options = document.createElement('ul');
                    options.className = 'options';
                    
                    q.options.forEach((option, oIndex) => {
                        const li = document.createElement('li');
                        li.className = `option ${userAnswers[qIndex] === oIndex ? 'selected' : ''}`;
                        li.textContent = `${String.fromCharCode(65 + oIndex)}) ${option}`;
                        li.setAttribute('tabindex', '0'); // Make it focusable
                        li.onclick = function() {
                            // Remove selected class from all options in this question
                            const siblings = this.parentNode.childNodes;
                            for (let i = 0; i < siblings.length; i++) {
                                siblings[i].classList.remove('selected');
                            }
                            // Add selected class to this option
                            this.classList.add('selected');
                            // Store answer
                            userAnswers[qIndex] = oIndex;
                            // Update progress
                            updateTestProgress();
                        };
                        options.appendChild(li);
                    });
                    
                    question.appendChild(options);
                    container.appendChild(question);
                });
                
                // Create submit button
                addSubmitButton(container, () => {
                    // Score multiple choice
                    let score = 0;
                    testQuestions.forEach((q, qIndex) => {
                        if (userAnswers[qIndex] === q.correctAnswer) {
                            score++;
                        }
                    });
                    
                    // Mark correct/incorrect
                    testQuestions.forEach((q, qIndex) => {
                        const questionOptions = document.querySelectorAll(`.question:nth-child(${qIndex + 1}) .option`);
                        questionOptions.forEach((option, oIndex) => {
                            if (oIndex === q.correctAnswer) {
                                option.classList.add('correct');
                            } else if (userAnswers[qIndex] === oIndex) {
                                option.classList.add('incorrect');
                            }
                        });
                    });
                    
                    return score;
                });
            }
            
            function renderTrueFalseTest(container) {
                // Create questions
                testQuestions.forEach((q, qIndex) => {
                    const question = document.createElement('div');
                    question.className = 'question';
                    
                    const title = document.createElement('h3');
                    title.textContent = `${qIndex + 1}. ${q.question}`;
                    question.appendChild(title);
                    
                    const options = document.createElement('ul');
                    options.className = 'options';
                    
                    // True option
                    const trueOption = document.createElement('li');
                    trueOption.className = `option ${userAnswers[qIndex] === true ? 'selected' : ''}`;
                    trueOption.textContent = 'True';
                    trueOption.onclick = function() {
                        const siblings = this.parentNode.childNodes;
                        for (let i = 0; i < siblings.length; i++) {
                            siblings[i].classList.remove('selected');
                        }
                        this.classList.add('selected');
                        userAnswers[qIndex] = true;
                    };
                    
                    // False option
                    const falseOption = document.createElement('li');
                    falseOption.className = `option ${userAnswers[qIndex] === false ? 'selected' : ''}`;
                    falseOption.textContent = 'False';
                    falseOption.onclick = function() {
                        const siblings = this.parentNode.childNodes;
                        for (let i = 0; i < siblings.length; i++) {
                            siblings[i].classList.remove('selected');
                        }
                        this.classList.add('selected');
                        userAnswers[qIndex] = false;
                    };
                    
                    options.appendChild(trueOption);
                    options.appendChild(falseOption);
                    
                    question.appendChild(options);
                    container.appendChild(question);
                });
                
                // Create submit button
                addSubmitButton(container, () => {
                    // Score true/false
                    let score = 0;
                    testQuestions.forEach((q, qIndex) => {
                        if (userAnswers[qIndex] === q.correctAnswer) {
                            score++;
                        }
                    });
                    
                    // Mark correct/incorrect
                    testQuestions.forEach((q, qIndex) => {
                        const questionOptions = document.querySelectorAll(`.question:nth-child(${qIndex + 1}) .option`);
                        const trueOption = questionOptions[0];
                        const falseOption = questionOptions[1];
                        
                        if (q.correctAnswer === true) {
                            trueOption.classList.add('correct');
                            if (userAnswers[qIndex] === false) {
                                falseOption.classList.add('incorrect');
                            }
                        } else {
                            falseOption.classList.add('correct');
                            if (userAnswers[qIndex] === true) {
                                trueOption.classList.add('incorrect');
                            }
                        }
                    });
                    
                    return score;
                });
            }
            
            function renderFillBlankTest(container) {
                // Create questions
                testQuestions.forEach((q, qIndex) => {
                    const question = document.createElement('div');
                    question.className = 'question';
                    
                    const title = document.createElement('h3');
                    title.textContent = `${qIndex + 1}. ${q.question}`;
                    question.appendChild(title);
                    
                    const answerInput = document.createElement('input');
                    answerInput.type = 'text';
                    answerInput.placeholder = 'Your answer...';
                    answerInput.className = 'form-control';
                    answerInput.style.width = '100%';
                    answerInput.style.padding = '10px';
                    answerInput.style.marginTop = '10px';
                    answerInput.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                    answerInput.style.border = '1px solid rgba(255, 255, 255, 0.2)';
                    answerInput.style.borderRadius = '8px';
                    answerInput.style.color = 'var(--light)';
                    
                    answerInput.oninput = function() {
                        userAnswers[qIndex] = this.value.trim().toLowerCase();
                    };
                    
                    question.appendChild(answerInput);
                    container.appendChild(question);
                });
                
                // Create submit button
                addSubmitButton(container, () => {
                    // Score fill in the blank (allow partial credit)
                    let score = 0;
                    
                    testQuestions.forEach((q, qIndex) => {
                        const correctAnswer = q.answer.toLowerCase();
                        const userAnswer = userAnswers[qIndex] || '';
                        
                        // Show correct answer
                        const question = document.querySelector(`.question:nth-child(${qIndex + 1})`);
                        const answerInput = question.querySelector('input');
                        
                        if (userAnswer === correctAnswer) {
                            // Full credit for exact match
                            score++;
                            answerInput.style.backgroundColor = 'rgba(77, 213, 153, 0.2)';
                            answerInput.style.borderColor = 'var(--success)';
                        } else {
                            answerInput.style.backgroundColor = 'rgba(255, 82, 82, 0.2)';
                            answerInput.style.borderColor = 'var(--danger)';
                            
                            // Show correct answer
                            const correctDiv = document.createElement('div');
                            correctDiv.style.marginTop = '5px';
                            correctDiv.style.color = 'var(--success)';
                            correctDiv.textContent = `Correct answer: ${q.answer}`;
                            question.appendChild(correctDiv);
                        }
                    });
                    
                    return score;
                });
            }
            
            function renderMatchingTest(container) {
                // Create matching activity
                const termsContainer = document.createElement('div');
                termsContainer.className = 'matching-terms';
                termsContainer.style.marginBottom = '20px';
                
                const definitionsContainer = document.createElement('div');
                definitionsContainer.className = 'matching-definitions';
                
                // Randomize definitions order
                const shuffledIndices = [...Array(testQuestions.length).keys()];
                for (let i = shuffledIndices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffledIndices[i], shuffledIndices[j]] = [shuffledIndices[j], shuffledIndices[i]];
                }
                
                // Create terms
                testQuestions.forEach((q, qIndex) => {
                    const term = document.createElement('div');
                    term.className = 'question';
                    term.setAttribute('data-term-index', qIndex);
                    
                    const termContent = document.createElement('h3');
                    termContent.textContent = `${qIndex + 1}. ${q.term}`;
                    term.appendChild(termContent);
                    
                    // Dropdown for selecting definition
                    const select = document.createElement('select');
                    select.style.width = '100%';
                    select.style.padding = '8px';
                    select.style.marginTop = '10px';
                    select.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                    select.style.border = '1px solid rgba(255, 255, 255, 0.2)';
                    select.style.borderRadius = '8px';
                    select.style.color = 'var(--light)';
                    
                    // Add empty option
                    const emptyOption = document.createElement('option');
                    emptyOption.value = '';
                    emptyOption.textContent = '-- Select matching definition --';
                    select.appendChild(emptyOption);
                    
                    // Add all definitions as options
                    shuffledIndices.forEach((defIndex) => {
                        const option = document.createElement('option');
                        option.value = defIndex;
                        option.textContent = `${String.fromCharCode(65 + defIndex)}) ${testQuestions[defIndex].definition}`;
                        select.appendChild(option);
                    });
                    
                    select.onchange = function() {
                        userAnswers[qIndex] = parseInt(this.value);
                    };
                    
                    term.appendChild(select);
                    termsContainer.appendChild(term);
                });
                
                container.appendChild(termsContainer);
                
                // Create submit button
                addSubmitButton(container, () => {
                    // Score matching
                    let score = 0;
                    
                    testQuestions.forEach((q, qIndex) => {
                        const termDiv = document.querySelector(`[data-term-index="${qIndex}"]`);
                        const select = termDiv.querySelector('select');
                        
                        if (userAnswers[qIndex] === qIndex) {
                            // Correct match
                            score++;
                            select.style.backgroundColor = 'rgba(77, 213, 153, 0.2)';
                            select.style.borderColor = 'var(--success)';
                        } else {
                            // Incorrect match
                            select.style.backgroundColor = 'rgba(255, 82, 82, 0.2)';
                            select.style.borderColor = 'var(--danger)';
                            
                            // Show correct answer
                            const correctDiv = document.createElement('div');
                            correctDiv.style.marginTop = '5px';
                            correctDiv.style.color = 'var(--success)';
                            correctDiv.textContent = `Correct match: ${testQuestions[qIndex].definition}`;
                            termDiv.appendChild(correctDiv);
                        }
                    });
                    
                    return score;
                });
            }
            
            function renderMixedTest(container) {
                // Create questions based on their types
                testQuestions.forEach((q, qIndex) => {
                    const questionType = q.type || 'multiple-choice';
                    const questionContainer = document.createElement('div');
                    questionContainer.className = 'question';
                    
                    // Add type indicator
                    const typeIndicator = document.createElement('div');
                    typeIndicator.className = 'question-type-indicator';
                    typeIndicator.textContent = formatQuestionType(questionType);
                    typeIndicator.style.fontSize = '0.8rem';
                    typeIndicator.style.color = 'var(--gray)';
                    typeIndicator.style.marginBottom = '5px';
                    questionContainer.appendChild(typeIndicator);
                    
                    // Add question title
                    const title = document.createElement('h3');
                    title.textContent = `${qIndex + 1}. ${q.question}`;
                    questionContainer.appendChild(title);
                    
                    // Render based on type
                    if (questionType === 'multiple-choice') {
                        renderMultipleChoiceQuestion(questionContainer, q, qIndex);
                    } 
                    else if (questionType === 'true-false') {
                        renderTrueFalseQuestion(questionContainer, q, qIndex);
                    }
                    else if (questionType === 'fill-blank') {
                        renderFillBlankQuestion(questionContainer, q, qIndex);
                    }
                    
                    container.appendChild(questionContainer);
                });
                
                // Add submit button for the complete test
                addSubmitButton(container, () => {
                    // Score mixed tests
                    let score = 0;
                    
                    testQuestions.forEach((q, qIndex) => {
                        const questionType = q.type || 'multiple-choice';
                        const userAnswer = userAnswers[qIndex];
                        
                        if (questionType === 'multiple-choice') {
                            if (userAnswer === q.correctAnswer) score++;
                        }
                        else if (questionType === 'true-false') {
                            if (userAnswer === q.correctAnswer) score++;
                        }
                        else if (questionType === 'fill-blank') {
                            if (userAnswer && userAnswer.toLowerCase() === q.answer.toLowerCase()) score++;
                        }
                    });
                    
                    return score;
                });
            }
            
            function formatQuestionType(type) {
                switch(type) {
                    case 'multiple-choice': return 'Multiple Choice';
                    case 'true-false': return 'True/False';
                    case 'fill-blank': return 'Fill in the Blank';
                    case 'matching': return 'Matching';
                    default: return type.charAt(0).toUpperCase() + type.slice(1);
                }
            }
            
            function renderMultipleChoiceQuestion(container, question, qIndex) {
                const options = document.createElement('ul');
                options.className = 'options';
                
                question.options.forEach((option, oIndex) => {
                    const li = document.createElement('li');
                    li.className = `option ${userAnswers[qIndex] === oIndex ? 'selected' : ''}`;
                    li.textContent = `${String.fromCharCode(65 + oIndex)}) ${option}`;
                    li.setAttribute('tabindex', '0'); // Make it focusable
                    li.onclick = function() {
                        // Remove selected class from all options in this question
                        const siblings = this.parentNode.childNodes;
                        for (let i = 0; i < siblings.length; i++) {
                            siblings[i].classList.remove('selected');
                        }
                        // Add selected class to this option
                        this.classList.add('selected');
                        // Store answer
                        userAnswers[qIndex] = oIndex;
                        // Update progress
                        updateTestProgress();
                    };
                    options.appendChild(li);
                });
                
                container.appendChild(options);
            }
            
            function renderTrueFalseQuestion(container, question, qIndex) {
                const options = document.createElement('ul');
                options.className = 'options';
                
                // True option
                const trueOption = document.createElement('li');
                trueOption.className = `option ${userAnswers[qIndex] === true ? 'selected' : ''}`;
                trueOption.textContent = 'True';
                trueOption.onclick = function() {
                    const siblings = this.parentNode.childNodes;
                    for (let i = 0; i < siblings.length; i++) {
                        siblings[i].classList.remove('selected');
                    }
                    this.classList.add('selected');
                    userAnswers[qIndex] = true;
                };
                
                // False option
                const falseOption = document.createElement('li');
                falseOption.className = `option ${userAnswers[qIndex] === false ? 'selected' : ''}`;
                falseOption.textContent = 'False';
                falseOption.onclick = function() {
                    const siblings = this.parentNode.childNodes;
                    for (let i = 0; i < siblings.length; i++) {
                        siblings[i].classList.remove('selected');
                    }
                    this.classList.add('selected');
                    userAnswers[qIndex] = false;
                };
                
                options.appendChild(trueOption);
                options.appendChild(falseOption);
                
                container.appendChild(options);
            }
            
            function renderFillBlankQuestion(container, question, qIndex) {
                const answerInput = document.createElement('input');
                answerInput.type = 'text';
                answerInput.placeholder = 'Your answer...';
                answerInput.className = 'form-control';
                answerInput.style.width = '100%';
                answerInput.style.padding = '10px';
                answerInput.style.marginTop = '10px';
                answerInput.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                answerInput.style.border = '1px solid rgba(255, 255, 255, 0.2)';
                answerInput.style.borderRadius = '8px';
                answerInput.style.color = 'var(--light)';
                
                answerInput.oninput = function() {
                    userAnswers[qIndex] = this.value.trim().toLowerCase();
                };
                
                container.appendChild(answerInput);
            }
            
            function addSubmitButton(container, scoreFunction) {
                const submitBtn = document.createElement('button');
                submitBtn.className = 'submit-button';
                submitBtn.textContent = 'Submit Test';
                submitBtn.onclick = function() {
                    if (Object.keys(userAnswers).length < testQuestions.length) {
                        alert('Please answer all questions before submitting!');
                        return;
                    }
                    
                    // Score test
                    const score = scoreFunction();
                    
                    // Show results
                    this.style.display = 'none';
                    showTestResults(score);
                };
                
                container.appendChild(submitBtn);
            }
            
            function showTestResults(correct) {
                const result = document.createElement('div');
                result.className = 'result';
                
                const total = testQuestions.length;
                const percentage = Math.round((correct / total) * 100);
                
                const title = document.createElement('h3');
                title.textContent = 'Test Results';
                
                const scoreElement = document.createElement('div');
                scoreElement.className = 'score';
                scoreElement.textContent = `${percentage}%`;
                
                // Set color based on score
                if (percentage < 60) {
                    scoreElement.style.color = 'var(--danger)';
                } else if (percentage < 80) {
                    scoreElement.style.color = 'var(--warning)';
                } else {
                    scoreElement.style.color = 'var(--success)';
                }
                
                const details = document.createElement('p');
                details.textContent = `You got ${correct} out of ${total} correct.`;
                
                result.appendChild(title);
                result.appendChild(scoreElement);
                result.appendChild(details);
                
                explanationOutput.insertBefore(result, explanationOutput.firstChild);
            }

            explainBtn.addEventListener('click', () => fetchAIResponse('explain'));
            customizeFlashcardsBtn.addEventListener('click', showFlashcardCustomization);
            customizeTestBtn.addEventListener('click', showTestCustomization);
            savedContentBtn.addEventListener('click', showSavedContent);
            
            // Initialize modal events
            const cancelSaveBtn = document.getElementById('cancelSaveBtn');
            cancelSaveBtn.addEventListener('click', function() {
                document.getElementById('saveModal').classList.remove('visible');
            });

            // New functions for save/list feature
            function addSaveButton() {
                // Remove any existing save buttons first
                const existingSaveBtn = document.querySelector('.save-btn');
                if (existingSaveBtn) {
                    existingSaveBtn.remove();
                }
                
                // Create save button
                const saveBtn = document.createElement('button');
                saveBtn.className = 'save-btn';
                saveBtn.textContent = 'Save this content';
                saveBtn.onclick = function() {
                    openSaveModal();
                };
                
                // Append after the content box
                const outputArea = document.querySelector('.output-area');
                outputArea.appendChild(saveBtn);
            }
            
            function openSaveModal() {
                const modal = document.getElementById('saveModal');
                const saveNameInput = document.getElementById('saveNameInput');
                const confirmSaveBtn = document.getElementById('confirmSaveBtn');
                const cancelSaveBtn = document.getElementById('cancelSaveBtn');
                
                // Generate a default name based on content type and topic
                const contentType = currentContent.type === 'explain' ? 'Explanation' : 
                                   currentContent.type === 'flashcards' ? 'Flashcards' : 'Test';
                saveNameInput.value = `${contentType} - ${currentContent.topic} (${currentContent.age} yo)`;
                
                // Show modal
                modal.classList.add('visible');
                saveNameInput.focus();
                
                // Handle save button
                const saveHandler = function() {
                    saveContent(saveNameInput.value);
                    modal.classList.remove('visible');
                    confirmSaveBtn.removeEventListener('click', saveHandler);
                };
                
                confirmSaveBtn.addEventListener('click', saveHandler);
                
                // Handle cancel button
                cancelSaveBtn.onclick = function() {
                    modal.classList.remove('visible');
                    confirmSaveBtn.removeEventListener('click', saveHandler);
                };
                
                // Handle Enter key
                saveNameInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        saveHandler();
                    } else if (e.key === 'Escape') {
                        cancelSaveBtn.click();
                    }
                });
            }
            
            function saveContent(name) {
                // Get existing saved content or initialize a new array
                const savedContent = JSON.parse(localStorage.getItem('eli5-saved-content') || '[]');
                
                // Create a new saved item
                const newItem = {
                    id: Date.now(),
                    name: name,
                    type: currentContent.type,
                    topic: currentContent.topic,
                    age: currentContent.age,
                    content: currentContent.content,
                    timestamp: currentContent.timestamp
                };
                
                // Add to saved content
                savedContent.push(newItem);
                
                // Save back to localStorage
                localStorage.setItem('eli5-saved-content', JSON.stringify(savedContent));
                
                // Show notification
                showNotification(`"${name}" saved successfully`);
            }
            
            function showSavedContent() {
                // Get saved content
                const savedContent = JSON.parse(localStorage.getItem('eli5-saved-content') || '[]');
                
                if (savedContent.length === 0) {
                    explanationOutput.innerHTML = `
                        <div class="saved-list-container">
                            <h3>Saved Content</h3>
                            <p>You haven't saved any content yet.</p>
                        </div>
                    `;
                    return;
                }
                
                // Create container
                explanationOutput.innerHTML = `
                    <div class="saved-list-container">
                        <h3>Saved Content</h3>
                        <div class="tab-buttons">
                            <button class="tab-button active" data-type="all">All</button>
                            <button class="tab-button" data-type="explain">Explanations</button>
                            <button class="tab-button" data-type="flashcards">Flashcards</button>
                            <button class="tab-button" data-type="test">Tests</button>
                        </div>
                        <div class="saved-items"></div>
                    </div>
                `;
                
                // Get elements
                const tabButtons = document.querySelectorAll('.tab-button');
                const savedItemsContainer = document.querySelector('.saved-items');
                
                // Filter function
                function filterItems(type) {
                    let items = savedContent;
                    if (type !== 'all') {
                        items = savedContent.filter(item => item.type === type);
                    }
                    renderSavedItems(items);
                }
                
                // Add event listeners to tab buttons
                tabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        filterItems(this.getAttribute('data-type'));
                    });
                });
                
                // Initial render - all items
                renderSavedItems(savedContent);
                
                function renderSavedItems(items) {
                    savedItemsContainer.innerHTML = '';
                    
                    if (items.length === 0) {
                        savedItemsContainer.innerHTML = '<p>No saved content found for this type.</p>';
                        return;
                    }
                    
                    // Sort by timestamp (newest first)
                    items.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    // Render each item
                    items.forEach(item => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'saved-item';
                        
                        const typeClass = item.type === 'explain' ? 'explanation' : item.type;
                        const typeLabel = item.type === 'explain' ? 'Explanation' : 
                                          item.type === 'flashcards' ? 'Flashcards' : 'Test';
                        
                        itemElement.innerHTML = `
                            <span class="saved-item-type">${typeLabel}</span>
                            <span class="saved-item-title">${item.name}</span>
                            <div class="saved-item-actions">
                                <button class="load-btn" title="Load this content"></button>
                                <button class="delete-btn" title="Delete this content"></button>
                            </div>
                        `;
                        
                        // Add event listeners
                        const loadBtn = itemElement.querySelector('.load-btn');
                        const deleteBtn = itemElement.querySelector('.delete-btn');
                        
                        loadBtn.addEventListener('click', () => loadSavedContent(item));
                        deleteBtn.addEventListener('click', () => deleteSavedContent(item.id));
                        
                        savedItemsContainer.appendChild(itemElement);
                    });
                }
            }
            
            function loadSavedContent(item) {
                // Set input fields
                topicInput.value = item.topic;
                ageInput.value = item.age;
                
                // Update current content
                currentContent = {
                    type: item.type,
                    topic: item.topic,
                    age: item.age,
                    content: item.content,
                    timestamp: item.timestamp
                };
                
                // Render based on type
                if (item.type === 'explain') {
                    animateContent();
                    explanationOutput.textContent = item.content;
                    addSaveButton();
                }
                else if (item.type === 'flashcards') {
                    flashcards = item.content;
                    currentCardIndex = 0;
                    renderFlashcards();
                }
                else if (item.type === 'test') {
                    testQuestions = item.content;
                    userAnswers = {};
                    renderTest();
                }
                
                showNotification(`Loaded: "${item.name}"`);
            }
            
            function deleteSavedContent(id) {
                // Get saved content
                const savedContent = JSON.parse(localStorage.getItem('eli5-saved-content') || '[]');
                
                // Find the item to delete
                const itemToDelete = savedContent.find(item => item.id === id);
                if (!itemToDelete) return;
                
                // Filter out the item
                const updatedContent = savedContent.filter(item => item.id !== id);
                
                // Save updated content
                localStorage.setItem('eli5-saved-content', JSON.stringify(updatedContent));
                
                // Re-render saved content
                showSavedContent();
                
                // Show notification
                showNotification(`"${itemToDelete.name}" deleted`);
            }
        });
    </script>
</body>
</html>
